# =================================================================
# Newifi 3 D2 (MT7621) 纯有线网关 + 混合存储架构 终极配置单
# 目标：Hysteria 2 高性能载体 | 轻量级 NAS | 极致精简
# =================================================================

# --- 1. 目标平台设定 (Target System) ---
CONFIG_TARGET_ramips=y
CONFIG_TARGET_ramips_mt7621=y
CONFIG_TARGET_ramips_mt7621_DEVICE_d-team_newifi-d2=y

# --- 2. 核心减法策略 (The Exclusion List) ---
# [无线移除] 纯网关模式，彻底移除 WiFi 堆栈以节省 ~4MB 空间
# CONFIG_PACKAGE_kmod-mt76 is not set
# CONFIG_PACKAGE_kmod-mt7603 is not set
# CONFIG_PACKAGE_kmod-mt7615-firmware is not set
# CONFIG_PACKAGE_kmod-mt76x2 is not set
# CONFIG_PACKAGE_wpad-basic-wolfssl is not set
# CONFIG_PACKAGE_hostapd-common is not set
# CONFIG_PACKAGE_iwinfo is not set

# [IPv6 精简] 保留内核模块以防编译报错，但移除所有用户态工具
# CONFIG_PACKAGE_odhcp6c is not set
# CONFIG_PACKAGE_odhcpd-ipv6only is not set
# CONFIG_PACKAGE_luci-proto-ipv6 is not set
# CONFIG_PACKAGE_ipv6helper is not set

# [应用精简] 移除臃肿的 Samba4 (后续用 KSMBD 替代)
# CONFIG_PACKAGE_luci-app-samba4 is not set
# CONFIG_PACKAGE_autosamba is not set
# CONFIG_PACKAGE_samba4-libs is not set

# --- 3. 核心加法：存储与 USB 子系统 (Storage Stack) ---
# [基础] USB 3.0 支持
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_kmod-usb-storage=y
# [性能核心] UAS (USB Attached SCSI) 支持 - 降低 CPU 中断负载的关键
CONFIG_PACKAGE_kmod-usb-storage-uas=y
# [文件系统] EXT4 (Linux 原生) 和 NTFS3 (Paragon 高性能驱动)
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-ntfs3=y
# [编码] 避免 U 盘中文文件名乱码
CONFIG_PACKAGE_kmod-nls-utf8=y
# [挂载] 自动挂载工具
CONFIG_PACKAGE_block-mount=y

# --- 4. 核心加法：内存与性能优化 (Performance) ---
# [ZRAM] 启用压缩内存
CONFIG_PACKAGE_zram-swap=y
# [算法] LZ4 压缩库 - 专为 MIPS 架构优化的低延迟解压算法
CONFIG_PACKAGE_kmod-lib-lz4=y

# --- 5. 核心加法：网络与代理依赖 (Network Stack) ---
# [必需] TUN 设备 - Hysteria/Sing-box 运行的基础
CONFIG_PACKAGE_kmod-tun=y
# [安全] CA 根证书库 & HTTPS 下载工具 (使用轻量级 SSL)
CONFIG_PACKAGE_ca-bundle=y
CONFIG_PACKAGE_wget-ssl=y
# [进阶] TProxy 模块 (为未来可能的透明代理留后路)
CONFIG_PACKAGE_kmod-nft-tproxy=y

# --- 6. 核心加法：轻量级 NAS (Lightweight NAS) ---
# [KSMBD] 内核态 SMB 服务器，CPU 占用仅为 Samba 的 50%
CONFIG_PACKAGE_ksmbd-server=y
CONFIG_PACKAGE_luci-app-ksmbd=y

# --- 7. 实用工具集 (Utilities - Revised) ---
# [编辑器与监控]
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_htop=y
# [磁盘管理] 格式化(mkfs.ext4)、修复(fsck)、分区(fdisk)工具
# 让路由器具备独立初始化 U 盘的能力
CONFIG_PACKAGE_e2fsprogs=y
CONFIG_PACKAGE_fdisk=y
CONFIG_PACKAGE_lsblk=y
CONFIG_PACKAGE_resize2fs=y
